{% extends "base.html"%}

{% block title %}Contactbook{% endblock title %}

{% block content %}
<h1 class="mt-5">My Contactbook</h1>

<form class="my-3" action="{% url 'search' %}" method="get" id="search"></form>
<form action="{% url 'add'%}" method="post" id="add"></form>

<div class="form-group row">
	<div class="col">
		<input class="form-control" type="search" placeholder="Search" aria-label="Search" name="term" value="{{ request.GET.term }}" form="search">
	</div>
	<div class="collapse" id="contact-form">
		<div class="card card-body">
			{% csrf_token %}
			{{ contact_form }}
		</div>
	</div>
	<button class="btn btn-success" type="button" data-bs-toggle="collapse" data-bs-target="#contact-form" aria-expanded="false" aria-controls="contact-form">
		+
	</button>
</div>

<table class="table">
	<thead>
		<tr>
			<th>ID</th>
			<th>Name</th>
			<th>Surname</th>
			<th>Phone Number</th>
			<th>Category</th>
		</tr>
	</thead>
	<tbody>
		{% for contact in contacts %}
		<tr>
			<td>{{ contact.id }}</td>
			<td>
				<a href="{% url 'contact' contact_id=contact.id %}">{{ contact.name }}</a>
			</td>
			<td>{{ contact.surname }}</td>
			<td>{{ contact.phone }}</td>
			<td>{{ contact.category }}</td>
		</tr>
		{% endfor %}
	</tbody>
</table>

<nav aria-label="Contacts page navigation">
	<ul class="pagination">
		{% if contacts.has_previous %}
		<li class="page-item"><a class="page-link" href="?page=1&term={{ request.GET.term }}">First</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ contacts.previous_page_number }}&term={{ request.GET.term }}">&laquo;</a></li>
		{% endif %}

		{% for page_number in contacts.paginator.page_range %}
			{% if page_number <= contacts.number|add:3 and page_number >= contacts.number|add:-3 %}
				{% if contacts.number == page_number %}
				<li class="page-item active">
					<a class="page-link" href="?page={{ page_number }}&term={{ request.GET.term }}">{{ page_number }}</a>
				</li>
				{% else %}
				<li class="page-item">
					<a class="page-link" href="?page={{ page_number }}&term={{ request.GET.term }}">{{ page_number }}</a>
				</li>
				{% endif %}
			{% endif %}
		{% endfor %}

		{% if contacts.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ contacts.next_page_number }}&term={{ request.GET.term }}">&raquo;</a></li>
		<li class="page-item"><a class="page-link" href="?page={{ contact.num_pages }}&term={{ request.GET.term }}">Last</a></li>
		{% endif %}
	</ul>
</nav>
{% endblock content %}